<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOL - Lehrpersonen-Dashboard</title>
    <!-- Tailwind CSS CDN für modernes Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .main-container {
            background-color: #ffffff;
            background-image: radial-gradient(at 0% 0%, #a5b4fc 0, transparent 50%),
                              radial-gradient(at 100% 100%, #60a5fa 0, transparent 50%);
            background-size: 100% 100%;
            background-position: center;
        }
        .header-container {
            background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Style für den aktiven Haupt-Tab */
        .tab-button.active {
            color: #4338ca;
            border-bottom-width: 3px;
            border-color: #4338ca;
            font-weight: 600;
        }
        /* Style für den aktiven Unter-Tab */
        .sub-tab-button.active {
            color: #4338ca;
            border-bottom-width: 2px;
            border-color: #4338ca;
            font-weight: 600;
        }
        /* CSS-Übergänge für reibungslose Tab-Wechsel */
        .tab-content, .sub-tab-content {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Angepasste, kompaktere Stile für die Stundenplan-Zellen */
        .timetable-grid-cell {
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            word-break: break-word; /* Fächer können über mehrere Zeilen gehen */
        }
        .timetable-time-cell {
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            width: 100px;
        }
        /* Post-it-Stil für den Arbeitsplan */
        .post-it {
            background-color: #fcf19d; /* Helles Gelb für den Post-it-Effekt */
            transform: rotate(1deg);
            transition: transform 0.2s ease-in-out;
        }
        .post-it:hover {
            transform: rotate(-1deg);
        }
        .post-it-title {
            font-family: 'Poppins', sans-serif;
            color: #4b5563; /* graue Farbe */
        }
        .checkmark {
            color: green;
        }
        .crossmark {
            color: red;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header mit Titel und Abmelde-Button -->
    <header class="header-container py-4 px-6 md:px-10 flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-900">Lehrpersonen-Dashboard</h1>
        <button id="logoutBtn" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-xl shadow hover:bg-red-600 transition duration-300">
            Abmelden
        </button>
    </header>

    <!-- Hauptinhalt mit Tabs -->
    <main class="flex-1 flex items-center justify-center p-6 md:p-10">
        <div class="main-container max-w-6xl w-full p-8 md:p-12 rounded-3xl shadow-2xl">
            <!-- Haupt-Tab-Navigation -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex flex-wrap space-x-4 md:space-x-8" aria-label="Tabs">
                    <button id="wochenplan-tab" class="tab-button inline-flex items-center px-1 py-4 text-lg font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                        Wochenstundenplan
                    </button>
                    <button id="arbeitsplan-tab" class="tab-button inline-flex items-center px-1 py-4 text-lg font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                        Arbeitsplan
                    </button>
                    <button id="sus-tab" class="tab-button inline-flex items-center px-1 py-4 text-lg font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                        SuS-Übersicht
                    </button>
                    <button id="verwaltung-tab" class="tab-button inline-flex items-center px-1 py-4 text-lg font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                        Verwaltung
                    </button>
                </nav>
            </div>

            <!-- Tab-Inhalte -->
            <div id="tab-content-container">
                <!-- Wochenstundenplan-Inhalt -->
                <div id="wochenplan-content" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Wochenstundenplan</h2>
                    <p class="text-gray-600">
                        Hier wird der Stundenplan für die aktuelle Woche angezeigt. Klicken Sie auf eine "SOL"-Lektion, um sie zu blockieren und eine Aktivität hinzuzufügen.
                    </p>
                    <div id="weekly-timetable-container" class="mt-6">
                        <!-- Stundenplan wird hier durch JS eingefügt -->
                        <div class="text-center text-gray-500 my-8">
                            <span class="animate-pulse">Stundenplan wird geladen...</span>
                        </div>
                    </div>
                </div>

                <!-- Arbeitsplan-Inhalt -->
                <div id="arbeitsplan-content" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Arbeitsplan</h2>
                    <p class="text-gray-600 mb-6">
                        Hier können Sie Aufträge für die SOL-Fächer hinzufügen.
                    </p>
                    <div id="sol-arbeitsplan-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Die Post-its werden hier von JS eingefügt -->
                        <div class="text-center text-gray-500 my-8 col-span-full">
                            <span class="animate-pulse">Arbeitspläne werden geladen...</span>
                        </div>
                    </div>
                </div>

                <!-- SuS-Übersicht-Inhalt -->
                <div id="sus-content" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">SuS-Übersicht</h2>
                    <p class="text-gray-600">
                        Hier erhalten Lehrpersonen einen Überblick über den Fortschritt der Schülerinnen und Schüler.
                    </p>
                </div>

                <!-- Verwaltung-Inhalt mit Unter-Tabs -->
                <div id="verwaltung-content" class="tab-content hidden">
                    <!-- Unter-Tab-Navigation -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-8" aria-label="Sub-Tabs">
                            <button id="stundenplan-subtab-btn" class="sub-tab-button active inline-flex items-center px-1 py-4 text-base font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                                Stundenplan
                            </button>
                            <button id="sol-subtab-btn" class="sub-tab-button inline-flex items-center px-1 py-4 text-base font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                                SOL-Fächer
                            </button>
                            <button id="accounts-subtab-btn" class="sub-tab-button inline-flex items-center px-1 py-4 text-base font-medium text-gray-500 hover:text-gray-700 transition duration-200">
                                Accounts
                            </button>
                        </nav>
                    </div>

                    <!-- Unter-Tab-Inhalte -->
                    <div id="sub-tab-content-container">
                        <!-- Stundenplan-Verwaltung -->
                        <div id="stundenplan-subtab" class="sub-tab-content">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Stundenplan-Verwaltung</h2>
                            <p class="text-gray-600 mb-6">
                                Tragen Sie hier den Stundenplan für die ganze Woche ein. Die Änderungen werden gespeichert, sobald Sie auf den "Speichern"-Button klicken.
                            </p>
                            <div id="admin-timetable-container" class="overflow-x-auto">
                                <!-- Stundenplan-Tabelle wird hier durch JS eingefügt -->
                                <div class="text-center text-gray-500 my-8">
                                    <span class="animate-pulse">Stundenplan wird geladen...</span>
                                </div>
                            </div>
                            <div class="mt-8 flex flex-col md:flex-row items-center justify-between gap-4">
                                <button id="saveTimetableBtn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-xl shadow-md hover:bg-indigo-700 transition duration-300">
                                    Stundenplan speichern
                                </button>
                                <div id="statusMessage" class="font-semibold text-sm"></div>
                            </div>
                        </div>

                        <!-- SOL-Fächer-Verwaltung -->
                        <div id="sol-subtab" class="sub-tab-content hidden">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">SOL-Fächer-Verwaltung</h2>
                            <p class="text-gray-600 mb-6">
                                Wählen Sie aus, welche Fächer als "Selbstorganisiertes Lernen" (SOL) unterrichtet werden sollen. Im Stundenplan werden diese dann als "SOL" angezeigt.
                            </p>
                            <div id="sol-subjects-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <!-- Fächer-Checkboxen werden hier durch JS eingefügt -->
                                <div class="text-center text-gray-500 my-8 col-span-full">
                                    <span class="animate-pulse">SOL-Fächer werden geladen...</span>
                                </div>
                            </div>
                            <button id="saveSolSubjectsBtn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-xl shadow-md hover:bg-indigo-700 transition duration-300">
                                SOL-Fächer speichern
                            </button>
                        </div>
                        
                        <!-- Accounts-Verwaltung (Platzhalter) -->
                        <div id="accounts-subtab" class="sub-tab-content hidden">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Accounts-Verwaltung</h2>
                            <p class="text-gray-600">
                                Hier werden in Zukunft Accounts für Schülerinnen, Schüler und Lehrpersonen verwaltet.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modal für SOL-Lektionen (im Stundenplan) -->
    <div id="sol-block-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-50 hidden flex items-center justify-center">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full m-4">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-gray-800">SOL-Lektion blockieren</h3>
            <form id="sol-block-form">
                <div class="mb-4">
                    <label for="block-type" class="block text-sm font-medium text-gray-700">Aktivitätstyp</label>
                    <select id="block-type" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="Lernkontrolle">Lernkontrolle</option>
                        <option value="LP-Input">LP-Input</option>
                        <option value="Anderes">Anderes</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="block-title" class="block text-sm font-medium text-gray-700">Titel</label>
                    <input type="text" id="block-title" placeholder="Kurzer Titel für die Lektion" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="mb-6">
                    <label for="block-description" class="block text-sm font-medium text-gray-700">Beschreibung</label>
                    <textarea id="block-description" rows="3" placeholder="Genaue Beschreibung, worum es geht" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div class="flex justify-between">
                    <div>
                        <button type="button" id="save-sol-block-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-indigo-700 transition duration-300">
                            Speichern
                        </button>
                        <button type="button" id="cancel-sol-block-btn" class="ml-2 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow hover:bg-gray-400 transition duration-300">
                            Abbrechen
                        </button>
                    </div>
                    <div>
                        <button type="button" id="delete-sol-block-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-red-600 transition duration-300 hidden">
                            Löschen
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal für Arbeitsplan-Aufträge (im Arbeitsplan-Tab) -->
    <div id="workplan-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-50 hidden flex items-center justify-center">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full m-4">
            <h3 id="workplan-modal-title" class="text-2xl font-bold mb-4 text-gray-800">Auftrag hinzufügen</h3>
            <form id="workplan-form">
                <input type="hidden" id="workplan-subject-name">
                <input type="hidden" id="workplan-assignment-index">
                <div class="mb-4">
                    <label for="workplan-title" class="block text-sm font-medium text-gray-700">Titel des Auftrags</label>
                    <input type="text" id="workplan-title" placeholder="Z.B. Einführung in Brüche" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="mb-4">
                    <label for="workplan-grundanforderungen" class="block text-sm font-medium text-gray-700">Grundanforderungen</label>
                    <textarea id="workplan-grundanforderungen" rows="3" placeholder="Beschreiben Sie hier die Grundanforderungen" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div class="mb-6">
                    <label for="workplan-erweiterte-anforderungen" class="block text-sm font-medium text-gray-700">Erweiterte Anforderungen (optional)</label>
                    <textarea id="workplan-erweiterte-anforderungen" rows="3" placeholder="Beschreiben Sie hier die erweiterten Anforderungen" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div class="flex justify-between">
                    <div>
                        <button type="button" id="save-workplan-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-indigo-700 transition duration-300">
                            Speichern
                        </button>
                        <button type="button" id="cancel-workplan-btn" class="ml-2 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow hover:bg-gray-400 transition duration-300">
                            Abbrechen
                        </button>
                    </div>
                    <div>
                        <button type="button" id="delete-workplan-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-red-600 transition duration-300 hidden">
                            Löschen
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal für die Schüler-Übersicht (im Arbeitsplan) -->
    <div id="overview-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <h3 id="overview-modal-title" class="text-2xl font-bold mb-4 text-gray-800">Schüler-Übersicht</h3>
            <p id="overview-assignment-title" class="text-lg text-gray-600 mb-4"></p>
            <div id="overview-table-container">
                <!-- Tabelle wird hier durch JS eingefügt -->
            </div>
            <div class="mt-6 text-right">
                <button type="button" id="close-overview-btn" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow hover:bg-gray-400 transition duration-300">
                    Schliessen
                </button>
            </div>
        </div>
    </div>
    
    <!-- Benutzerdefinierte Bestätigungsbox (ersetzt window.confirm) -->
    <div id="confirmation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-[1000] hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full m-4">
            <p id="confirmation-message" class="text-center text-lg font-medium mb-4">Sind Sie sicher?</p>
            <div class="flex justify-end space-x-2">
                <button id="confirm-yes" class="bg-red-500 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-red-600 transition duration-300">
                    Ja
                </button>
                <button id="confirm-no" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow hover:bg-gray-400 transition duration-300">
                    Nein
                </button>
            </div>
        </div>
    </div>
    
    <!-- Benutzerdefinierte Meldungsbox -->
    <div id="custom-alert-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-[1001] hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full m-4 text-center">
            <p id="alert-message" class="text-lg font-medium mb-4">Meldung</p>
            <button id="alert-ok-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-xl shadow hover:bg-indigo-700 transition duration-300">
                OK
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, deleteDoc, collection, getDocs, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase services
        let app;
        let db;
        let auth;
        let userId;

        // Firestore configuration (provided by Canvas)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Global data storage
        let timetableData = [];
        let solSubjectsData = [];
        let workplanData = {};
        let blockedSolLessons = [];
        let studentData = []; // Sample student data for demonstration

        // DOM Elements
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const subTabButtons = document.querySelectorAll('.sub-tab-button');
        const subTabContents = document.querySelectorAll('.sub-tab-content');
        const mainContainer = document.querySelector('.main-container');

        // Modals and buttons
        const solBlockModal = document.getElementById('sol-block-modal');
        const workplanModal = document.getElementById('workplan-modal');
        const overviewModal = document.getElementById('overview-modal');
        const confirmationModal = document.getElementById('confirmation-modal');
        const customAlertModal = document.getElementById('custom-alert-modal');
        const logoutBtn = document.getElementById('logoutBtn');
        const saveTimetableBtn = document.getElementById('saveTimetableBtn');
        const saveSolSubjectsBtn = document.getElementById('saveSolSubjectsBtn');
        const saveWorkplanBtn = document.getElementById('save-workplan-btn');
        const cancelWorkplanBtn = document.getElementById('cancel-workplan-btn');
        const deleteWorkplanBtn = document.getElementById('delete-workplan-btn');
        const closeOverviewBtn = document.getElementById('close-overview-btn');

        // Custom alert and confirmation functions
        function customAlert(message) {
            document.getElementById('alert-message').innerText = message;
            customAlertModal.classList.remove('hidden');
        }

        document.getElementById('alert-ok-btn').addEventListener('click', () => {
            customAlertModal.classList.add('hidden');
        });

        function customConfirm(message) {
            return new Promise((resolve) => {
                document.getElementById('confirmation-message').innerText = message;
                confirmationModal.classList.remove('hidden');
                document.getElementById('confirm-yes').onclick = () => {
                    confirmationModal.classList.add('hidden');
                    resolve(true);
                };
                document.getElementById('confirm-no').onclick = () => {
                    confirmationModal.classList.add('hidden');
                    resolve(false);
                };
            });
        }

        // Initialize Firebase and set up authentication
        async function initializeAppAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    // Set up the authentication state listener
                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            console.log('User signed in:', userId);
                            // Initial setup after successful login
                            setupFirestoreListeners();
                            showTab('wochenplan');
                            showSubTab('stundenplan');

                            // Initial rendering
                            renderWeeklyTimetable();
                            renderAdminTimetable();
                            renderSolSubjectsAdmin();
                            renderWorkplan();
                        } else {
                            userId = null;
                            console.log('No user signed in.');
                            // Handle signed out state, e.g., redirect to login
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(auth, initialAuthToken);
                                } else {
                                    await signInAnonymously(auth);
                                }
                            } catch (error) {
                                console.error('Authentication failed:', error);
                                customAlert('Die Authentifizierung ist fehlgeschlagen. Bitte versuchen Sie es später erneut.');
                            }
                        }
                    });

                    // Sign in with custom token if available, otherwise anonymously
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } else {
                    customAlert('Firebase-Konfiguration ist nicht verfügbar.');
                }
            } catch (error) {
                console.error('Initialisierungsfehler:', error);
                customAlert('Die Initialisierung ist fehlgeschlagen. Bitte versuchen Sie es später erneut.');
            }
        }

        // Firestore listener setup
        function setupFirestoreListeners() {
            if (!db || !userId) return;

            // Listener für Stundenplan-Daten
            const timetableDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/timetable`);
            onSnapshot(timetableDocRef, (docSnap) => {
                timetableData = docSnap.exists() ? docSnap.data().plan || [] : [];
                console.log('Stundenplan-Daten aktualisiert.');
                renderWeeklyTimetable();
                renderAdminTimetable();
            }, (error) => console.error("Fehler beim Laden des Stundenplans:", error));

            // Listener für SOL-Fächer
            const solSubjectsDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/sol-subjects`);
            onSnapshot(solSubjectsDocRef, (docSnap) => {
                solSubjectsData = docSnap.exists() ? docSnap.data().subjects || [] : [];
                console.log('SOL-Fächer-Daten aktualisiert.');
                renderSolSubjectsAdmin();
                renderWorkplan(); // Arbeitsplan neu rendern, da er von den SOL-Fächern abhängt
            }, (error) => console.error("Fehler beim Laden der SOL-Fächer:", error));

            // Listener für SOL-Lektionen
            const blockedLessonsDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/sol-lessons`);
            onSnapshot(blockedLessonsDocRef, (docSnap) => {
                blockedSolLessons = docSnap.exists() ? docSnap.data().blockedLessons || [] : [];
                console.log('Blockierte SOL-Lektionen aktualisiert.');
                renderWeeklyTimetable();
            }, (error) => console.error("Fehler beim Laden der SOL-Lektionen:", error));

            // Listener für Arbeitsplan-Daten
            const workplanDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/workplan`);
            onSnapshot(workplanDocRef, (docSnap) => {
                workplanData = docSnap.exists() ? docSnap.data().workplan || {} : {};
                console.log('Arbeitsplan-Daten aktualisiert.');
                renderWorkplan();
            }, (error) => console.error("Fehler beim Laden des Arbeitsplans:", error));

            // Beispiel-Daten für Schüler (Simuliert die Schüler-Tabelle)
            const studentsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/data/students`);
            onSnapshot(studentsCollectionRef, (querySnapshot) => {
                studentData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // Wenn sich die Schülerdaten ändern, muss der Arbeitsplan neu gerendert werden, um die Übersicht zu aktualisieren
                // renderWorkplan();
            }, (error) => console.error("Fehler beim Laden der Schülerdaten:", error));
            
            // Fügen wir initial einige Beispieldaten für Schüler hinzu, falls noch keine vorhanden sind.
            (async () => {
                const studentsSnap = await getDocs(studentsCollectionRef);
                if (studentsSnap.empty) {
                    const sampleStudents = [
                        { name: "Max Mustermann" },
                        { name: "Erika Musterfrau" },
                        { name: "Paul Beispiel" },
                        { name: "Lisa Testperson" },
                    ];
                    for (const student of sampleStudents) {
                        // Verwendung von setDoc mit einer generierten ID, um die Dokumente zu erstellen
                        // Die tatsächliche Schülerverwaltung würde hier anders aussehen, dies ist nur ein Beispiel.
                        await setDoc(doc(db, `artifacts/${appId}/users/${userId}/data/students`, crypto.randomUUID()), student);
                    }
                }
            })();
        }

        // --- View functions ---
        
        function showTab(tabId) {
            tabButtons.forEach(button => {
                button.classList.toggle('active', button.id === `${tabId}-tab`);
            });
            tabContents.forEach(content => {
                content.classList.toggle('hidden', content.id !== `${tabId}-content`);
            });
        }

        function showSubTab(subTabId) {
            subTabButtons.forEach(button => {
                button.classList.toggle('active', button.id === `${subTabId}-subtab-btn`);
            });
            subTabContents.forEach(content => {
                content.classList.toggle('hidden', content.id !== `${subTabId}-subtab`);
            });
        }

        // Stundenplan für Wochenansicht rendern
        function renderWeeklyTimetable() {
            const container = document.getElementById('weekly-timetable-container');
            if (!container) return;
            container.innerHTML = '';
            
            const days = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag'];
            const hours = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            
            // Generate timetable HTML
            let timetableHTML = `
                <div class="grid grid-cols-[100px_repeat(5,_minmax(0,_1fr))] border border-gray-300 rounded-xl overflow-hidden shadow-md">
                    <div class="p-2 border-b border-r bg-gray-100 font-semibold text-center">Zeit</div>
            `;
            days.forEach(day => {
                timetableHTML += `<div class="p-2 border-b border-r bg-gray-100 font-semibold text-center">${day}</div>`;
            });
            timetableHTML += '</div>';

            let currentTimetableHTML = `<div class="grid grid-cols-[100px_repeat(5,_minmax(0,_1fr))] border border-gray-300 rounded-xl overflow-hidden shadow-md">`;
            currentTimetableHTML += `<div class="p-2 border-b border-r bg-gray-100 font-semibold text-center timetable-time-cell">Zeit</div>`;
            days.forEach(day => {
                currentTimetableHTML += `<div class="p-2 border-b border-r bg-gray-100 font-semibold text-center timetable-grid-cell">${day}</div>`;
            });

            hours.forEach((hour, hourIndex) => {
                currentTimetableHTML += `
                    <div class="p-2 border-r border-b bg-gray-50 font-semibold flex items-center justify-center timetable-time-cell">${hour}</div>
                `;
                days.forEach((day, dayIndex) => {
                    const subject = timetableData?.[dayIndex]?.[hourIndex] || '';
                    const isSol = solSubjectsData.includes(subject);
                    const isBlocked = blockedSolLessons.some(b => b.day === day && b.hour === hour);
                    
                    let cellContent = subject;
                    let cellClasses = `p-2 border-r border-b bg-white text-gray-800 timetable-grid-cell`;
                    
                    if (isSol) {
                        cellContent = `<span class="font-bold text-indigo-600">SOL</span> - ${subject}`;
                        cellClasses += ` bg-indigo-50 cursor-pointer hover:bg-indigo-100 transition duration-200`;
                    }
                    
                    if (isBlocked) {
                        const blockedLesson = blockedSolLessons.find(b => b.day === day && b.hour === hour);
                        cellContent = `
                            <div class="flex flex-col items-center justify-center h-full">
                                <span class="font-bold text-red-600">${blockedLesson.title}</span>
                                <span class="text-xs text-red-500">${blockedLesson.type}</span>
                            </div>
                        `;
                        cellClasses += ` bg-red-100 cursor-pointer hover:bg-red-200 transition duration-200`;
                    }

                    currentTimetableHTML += `
                        <div class="${cellClasses}" data-day="${day}" data-hour="${hour}" data-subject="${subject}" data-sol="${isSol}" data-blocked="${isBlocked}">
                            ${cellContent}
                        </div>
                    `;
                });
            });
            currentTimetableHTML += `</div>`;
            container.innerHTML = currentTimetableHTML;
        
            // Add click listeners to SOL cells
            container.querySelectorAll('[data-sol="true"]').forEach(cell => {
                cell.addEventListener('click', (event) => {
                    const day = cell.dataset.day;
                    const hour = cell.dataset.hour;
                    const subject = cell.dataset.subject;
                    const isBlocked = cell.dataset.blocked === 'true';
                    showSolBlockModal(day, hour, subject, isBlocked);
                });
            });
        }

        // Stundenplan für Admin-Ansicht rendern
        function renderAdminTimetable() {
            const container = document.getElementById('admin-timetable-container');
            if (!container) return;
            container.innerHTML = '';
            
            const days = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag'];
            const hours = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const subjects = ['Mathematik', 'Deutsch', 'Englisch', 'Biologie', 'Chemie', 'Physik', 'Geografie', 'Geschichte', 'Sport', 'Kunst', 'Musik'];

            let timetableHTML = `
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-200 text-gray-700">
                            <th class="border p-2 text-left w-[100px]">Zeit</th>
            `;
            days.forEach(day => {
                timetableHTML += `<th class="border p-2 text-center">${day}</th>`;
            });
            timetableHTML += `
                        </tr>
                    </thead>
                    <tbody>
            `;
            hours.forEach((hour, hourIndex) => {
                timetableHTML += `
                    <tr>
                        <td class="border p-2 bg-gray-100 font-semibold">${hour}</td>
                `;
                days.forEach((day, dayIndex) => {
                    const selectedSubject = timetableData?.[dayIndex]?.[hourIndex] || '';
                    timetableHTML += `
                        <td class="border p-1">
                            <select class="w-full bg-transparent border-none focus:ring-0 p-1 admin-timetable-select" data-day-index="${dayIndex}" data-hour-index="${hourIndex}">
                                <option value="">---</option>
                    `;
                    subjects.forEach(subject => {
                        timetableHTML += `<option value="${subject}" ${selectedSubject === subject ? 'selected' : ''}>${subject}</option>`;
                    });
                    timetableHTML += `
                            </select>
                        </td>
                    `;
                });
                timetableHTML += `
                    </tr>
                `;
            });
            timetableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = timetableHTML;
        }

        // SOL-Fächer für Admin-Ansicht rendern
        function renderSolSubjectsAdmin() {
            const container = document.getElementById('sol-subjects-container');
            if (!container) return;
            container.innerHTML = '';

            const allSubjects = ['Mathematik', 'Deutsch', 'Englisch', 'Biologie', 'Chemie', 'Physik', 'Geografie', 'Geschichte', 'Sport', 'Kunst', 'Musik'];
            
            allSubjects.forEach(subject => {
                const isSol = solSubjectsData.includes(subject);
                container.innerHTML += `
                    <label class="flex items-center p-3 bg-white rounded-xl shadow-md cursor-pointer hover:bg-gray-50 transition duration-200">
                        <input type="checkbox" value="${subject}" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500" ${isSol ? 'checked' : ''}>
                        <span class="ml-3 text-sm font-medium text-gray-700">${subject}</span>
                    </label>
                `;
            });
        }

        // Arbeitsplan rendern
        function renderWorkplan() {
            const container = document.getElementById('sol-arbeitsplan-container');
            if (!container) return;
            container.innerHTML = '';

            // Zeige nur SOL-Fächer an
            const solSubjectsWorkplan = Object.entries(workplanData).filter(([subject]) => solSubjectsData.includes(subject));

            if (solSubjectsWorkplan.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 mt-8">
                        Es sind keine SOL-Fächer im Arbeitsplan verfügbar.
                    </div>
                `;
                return;
            }

            solSubjectsWorkplan.forEach(([subject, assignments]) => {
                container.innerHTML += `
                    <div class="bg-gray-100 p-6 rounded-xl shadow-md border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">${subject}</h3>
                        ${assignments.map((assignment, index) => `
                            <div class="bg-white p-4 rounded-xl shadow-sm mb-4 border border-gray-100 post-it">
                                <h4 class="font-bold post-it-title mb-2">${assignment.title}</h4>
                                <p class="text-sm text-gray-700 mb-4">${assignment.grundanforderungen}</p>
                                <div class="flex justify-between items-center space-x-2">
                                    <div class="flex-1">
                                        <button class="add-workplan-btn text-sm bg-indigo-500 text-white font-semibold py-1 px-3 rounded-md shadow-sm hover:bg-indigo-600 transition duration-300" data-subject="${subject}" data-index="${index}">
                                            Bearbeiten
                                        </button>
                                    </div>
                                    <div>
                                        <button class="overview-btn text-sm bg-blue-500 text-white font-semibold py-1 px-3 rounded-md shadow-sm hover:bg-blue-600 transition duration-300" data-subject="${subject}" data-index="${index}">
                                            Übersicht
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        <button class="add-workplan-btn mt-4 text-sm bg-green-500 text-white font-semibold py-2 px-4 rounded-xl shadow-sm hover:bg-green-600 transition duration-300" data-subject="${subject}" data-index="-1">
                            Auftrag hinzufügen
                        </button>
                    </div>
                `;
            });

            // Event-Listener für Bearbeiten-Buttons hinzufügen
            container.querySelectorAll('.add-workplan-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const subject = event.currentTarget.dataset.subject;
                    const index = parseInt(event.currentTarget.dataset.index, 10);
                    showWorkplanModal(subject, index);
                });
            });

            // Event-Listener für Übersicht-Buttons hinzufügen
            container.querySelectorAll('.overview-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const subject = event.currentTarget.dataset.subject;
                    const index = parseInt(event.currentTarget.dataset.index, 10);
                    showAssignmentOverview(subject, index);
                });
            });
        }
        
        // Modal zum Hinzufügen/Bearbeiten von SOL-Lektionen
        function showSolBlockModal(day, hour, subject, isBlocked) {
            const modalTitle = document.getElementById('modal-title');
            const saveBtn = document.getElementById('save-sol-block-btn');
            const deleteBtn = document.getElementById('delete-sol-block-btn');
            const form = document.getElementById('sol-block-form');

            const lesson = isBlocked ? blockedSolLessons.find(b => b.day === day && b.hour === hour) : null;

            if (isBlocked && lesson) {
                modalTitle.textContent = `SOL-Lektion bearbeiten (${day}, ${hour})`;
                document.getElementById('block-type').value = lesson.type;
                document.getElementById('block-title').value = lesson.title;
                document.getElementById('block-description').value = lesson.description;
                deleteBtn.classList.remove('hidden');
                saveBtn.textContent = 'Speichern';
            } else {
                modalTitle.textContent = `SOL-Lektion blockieren (${day}, ${hour})`;
                form.reset();
                deleteBtn.classList.add('hidden');
                saveBtn.textContent = 'Blockieren';
            }
            
            solBlockModal.classList.remove('hidden');

            saveBtn.onclick = async () => {
                const type = document.getElementById('block-type').value;
                const title = document.getElementById('block-title').value;
                const description = document.getElementById('block-description').value;
                if (!title || !description) {
                    customAlert('Titel und Beschreibung sind erforderlich.');
                    return;
                }

                const newBlock = { day, hour, type, title, description };
                const lessonsRef = doc(db, `artifacts/${appId}/users/${userId}/data/sol-lessons`);

                try {
                    await updateDoc(lessonsRef, {
                        blockedLessons: isBlocked ? arrayRemove(lesson) : arrayUnion(newBlock)
                    }, { merge: true });
                    
                    if (isBlocked) {
                         await updateDoc(lessonsRef, { blockedLessons: arrayUnion(newBlock) }, { merge: true });
                    }
                    
                    solBlockModal.classList.add('hidden');
                } catch (e) {
                    console.error('Fehler beim Speichern der SOL-Lektion:', e);
                    customAlert('Fehler beim Speichern der Lektion.');
                }
            };

            deleteBtn.onclick = async () => {
                if (await customConfirm('Sind Sie sicher, dass Sie diese Lektion löschen möchten?')) {
                    const lessonsRef = doc(db, `artifacts/${appId}/users/${userId}/data/sol-lessons`);
                    try {
                        await updateDoc(lessonsRef, {
                            blockedLessons: arrayRemove(lesson)
                        });
                        solBlockModal.classList.add('hidden');
                    } catch (e) {
                        console.error('Fehler beim Löschen der SOL-Lektion:', e);
                        customAlert('Fehler beim Löschen der Lektion.');
                    }
                }
            };
        }

        document.getElementById('cancel-sol-block-btn').addEventListener('click', () => {
            solBlockModal.classList.add('hidden');
        });

        // Modal zum Hinzufügen/Bearbeiten von Arbeitsplan-Aufträgen
        function showWorkplanModal(subject, index) {
            const modalTitle = document.getElementById('workplan-modal-title');
            const form = document.getElementById('workplan-form');
            const saveBtn = document.getElementById('save-workplan-btn');
            const deleteBtn = document.getElementById('delete-workplan-btn');

            document.getElementById('workplan-subject-name').value = subject;
            document.getElementById('workplan-assignment-index').value = index;

            // Bearbeitungsmodus
            if (index !== -1) {
                modalTitle.textContent = `Auftrag bearbeiten: ${subject}`;
                const assignment = workplanData[subject][index];
                document.getElementById('workplan-title').value = assignment.title;
                document.getElementById('workplan-grundanforderungen').value = assignment.grundanforderungen;
                document.getElementById('workplan-erweiterte-anforderungen').value = assignment.erweiterteAnforderungen;
                deleteBtn.classList.remove('hidden');
                saveBtn.textContent = 'Speichern';
            } else {
                // Hinzufügen-Modus
                modalTitle.textContent = `Neuer Auftrag für: ${subject}`;
                form.reset();
                deleteBtn.classList.add('hidden');
                saveBtn.textContent = 'Hinzufügen';
            }

            workplanModal.classList.remove('hidden');
        }

        // Modal für die Schüler-Übersicht anzeigen
        async function showAssignmentOverview(subject, index) {
            const assignment = workplanData[subject][index];
            const overviewTitle = document.getElementById('overview-assignment-title');
            const tableContainer = document.getElementById('overview-table-container');

            overviewTitle.textContent = `Auftrag: "${assignment.title}"`;
            tableContainer.innerHTML = `<p class="text-center text-gray-500">Lade Schülerdaten...</p>`;
            overviewModal.classList.remove('hidden');

            try {
                // Hier simulieren wir das Abrufen der Schülerdaten aus Firestore
                // Im echten Code würden Sie hier eine Query ausführen, um den Fortschritt der Schüler zu erhalten
                const studentsRef = collection(db, `artifacts/${appId}/users/${userId}/data/students`);
                const studentsSnapshot = await getDocs(studentsRef);
                const students = studentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Hier simulieren wir die Erfüllung der Anforderungen durch die Schüler
                const studentCompletionData = students.map(student => {
                    // Beispiel-Logik: Ein Zufallsgenerator simuliert den Erfüllungsstatus
                    const basicCompleted = Math.random() > 0.3; // 70% Wahrscheinlichkeit für Grundanforderungen
                    const advancedCompleted = basicCompleted && Math.random() > 0.5; // 50% der Grundanforderungs-Erfüller schaffen auch die Erweiterten
                    return {
                        name: student.name,
                        basic: basicCompleted,
                        advanced: advancedCompleted,
                    };
                });
                
                let tableHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 shadow-md rounded-xl">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Grundanforderungen
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Erweiterte Anforderungen
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                `;

                studentCompletionData.forEach(student => {
                    const basicIcon = student.basic ? '<span class="checkmark">✔</span>' : '<span class="crossmark">✖</span>';
                    const advancedIcon = student.advanced ? '<span class="checkmark">✔</span>' : '<span class="crossmark">✖</span>';

                    tableHTML += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                ${student.name}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                                ${basicIcon}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                                ${advancedIcon}
                            </td>
                        </tr>
                    `;
                });

                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                tableContainer.innerHTML = tableHTML;
            } catch (e) {
                console.error("Fehler beim Laden der Schüler-Übersicht:", e);
                tableContainer.innerHTML = `<p class="text-center text-red-500">Fehler beim Laden der Daten.</p>`;
            }
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', initializeAppAndAuth);

        // Haupt-Tab-Navigation
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                showTab(button.id.replace('-tab', ''));
            });
        });

        // Unter-Tab-Navigation
        subTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                showSubTab(button.id.replace('-subtab-btn', ''));
            });
        });

        // Abmelde-Funktionalität
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                customAlert('Sie wurden erfolgreich abgemeldet.');
            } catch (error) {
                console.error('Fehler beim Abmelden:', error);
                customAlert('Fehler beim Abmelden.');
            }
        });

        // Stundenplan speichern
        saveTimetableBtn.addEventListener('click', async () => {
            const newTimetable = [];
            const days = 5;
            const hours = 10;
            const selectElements = document.querySelectorAll('.admin-timetable-select');

            for (let d = 0; d < days; d++) {
                newTimetable[d] = [];
                for (let h = 0; h < hours; h++) {
                    const select = document.querySelector(`.admin-timetable-select[data-day-index="${d}"][data-hour-index="${h}"]`);
                    newTimetable[d][h] = select.value;
                }
            }

            const timetableDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/timetable`);
            try {
                await setDoc(timetableDocRef, { plan: newTimetable });
                document.getElementById('statusMessage').textContent = 'Stundenplan erfolgreich gespeichert!';
                document.getElementById('statusMessage').classList.remove('text-red-500');
                document.getElementById('statusMessage').classList.add('text-green-500');
            } catch (e) {
                console.error('Fehler beim Speichern des Stundenplans:', e);
                document.getElementById('statusMessage').textContent = 'Fehler beim Speichern des Stundenplans.';
                document.getElementById('statusMessage').classList.remove('text-green-500');
                document.getElementById('statusMessage').classList.add('text-red-500');
            }
            setTimeout(() => document.getElementById('statusMessage').textContent = '', 5000);
        });

        // SOL-Fächer speichern
        saveSolSubjectsBtn.addEventListener('click', async () => {
            const checkboxes = document.querySelectorAll('#sol-subjects-container input[type="checkbox"]:checked');
            const newSolSubjects = Array.from(checkboxes).map(cb => cb.value);

            const solSubjectsDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/sol-subjects`);
            try {
                await setDoc(solSubjectsDocRef, { subjects: newSolSubjects });
                customAlert('SOL-Fächer erfolgreich gespeichert!');
            } catch (e) {
                console.error('Fehler beim Speichern der SOL-Fächer:', e);
                customAlert('Fehler beim Speichern der SOL-Fächer.');
            }
        });

        // Arbeitsplan speichern
        saveWorkplanBtn.addEventListener('click', async () => {
            const subject = document.getElementById('workplan-subject-name').value;
            const index = parseInt(document.getElementById('workplan-assignment-index').value, 10);
            const title = document.getElementById('workplan-title').value;
            const grundanforderungen = document.getElementById('workplan-grundanforderungen').value;
            const erweiterteAnforderungen = document.getElementById('workplan-erweiterte-anforderungen').value;

            if (!title || !grundanforderungen) {
                customAlert('Titel und Grundanforderungen sind Pflichtfelder.');
                return;
            }

            const newAssignment = {
                title,
                grundanforderungen,
                erweiterteAnforderungen
            };

            const workplanDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/workplan`);
            let newWorkplan = { ...workplanData };

            if (!newWorkplan[subject]) {
                newWorkplan[subject] = [];
            }

            if (index === -1) {
                // Neuer Auftrag
                newWorkplan[subject].push(newAssignment);
            } else {
                // Auftrag bearbeiten
                newWorkplan[subject][index] = newAssignment;
            }
            
            try {
                await setDoc(workplanDocRef, { workplan: newWorkplan }, { merge: true });
                workplanModal.classList.add('hidden');
            } catch (e) {
                console.error('Fehler beim Speichern des Arbeitsplans:', e);
                customAlert('Fehler beim Speichern des Arbeitsplans.');
            }
        });

        // Arbeitsplan-Modal schliessen
        cancelWorkplanBtn.addEventListener('click', () => {
            workplanModal.classList.add('hidden');
        });

        // Arbeitsplan-Auftrag löschen
        deleteWorkplanBtn.addEventListener('click', async () => {
            if (await customConfirm('Sind Sie sicher, dass Sie diesen Auftrag löschen möchten?')) {
                const subject = document.getElementById('workplan-subject-name').value;
                const index = parseInt(document.getElementById('workplan-assignment-index').value, 10);

                const workplanDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/workplan`);
                let newWorkplan = { ...workplanData };
                
                if (newWorkplan[subject] && index !== -1) {
                    newWorkplan[subject].splice(index, 1);
                }

                try {
                    await setDoc(workplanDocRef, { workplan: newWorkplan }, { merge: true });
                    workplanModal.classList.add('hidden');
                } catch (e) {
                    console.error('Fehler beim Löschen des Auftrags:', e);
                    customAlert('Fehler beim Löschen des Auftrags.');
                }
            }
        });
        
        // Übersicht-Modal schliessen
        closeOverviewBtn.addEventListener('click', () => {
            overviewModal.classList.add('hidden');
        });

    </script>
</body>
</html>
